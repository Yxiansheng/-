### 浏览器渲染优化核心为提升浏览器的FPS

#### 概念：FPS（frame per second）即浏览器每秒绘制的次数，一般为保证看起来不会有明显的卡顿，我们一般要求FPS不低于24帧，游戏不低于30帧，页面流畅最低要达到60FPS


#### web每一帧的生成管道过程：
1. 我们会通过js、css去进行添加、修改Dom的样式等等改变dom外观的操作
2. 而经过这两个过程后会经过一个Layout的过程，根据生成的Dom树、CSS树形成一个真正将被绘制到屏幕上的Render树
3. 接下来是Paint过程，主线程遍历布局树，然后创建绘制记录。绘制记录是一个绘制过程的注释，即元素的绘制顺序
4. 最后是合成过程，有了以上的数据，就可以进行光栅化了，光栅化是将几何数据经过一系列变换后最终转换为像素，从而呈现在显示设备上的过程。而合成是一种将页面的各个元素进行分层，分别光栅化，并在合成器线程中以一个单独的线程合成新页面帧，最终被发送到GPU，保存在GPU内存中，以在屏幕上显示的技术。如果页面发生滚动，由于图层已经光栅化，因此它需要做的就是合成一个新帧。通过移动图层同时合成新帧，可以以相同的方式实现动画。
5. 注：Layout和Paint过程不是必定会经过的，要视改变的样式是在哪一层级具体表现，下面有几种情况：
    1. 如我们改变了元素的几何结构宽高或相对于其他元素的位置，必须重新计算受到影响的元素的位置时，就依次走完整个管道
    2. 而如改变的是文本颜色、背景等等单纯改变元素外观时，则不会经过Layout的过程，直接是Javascript+Style Recalculate+Paint+Composite
    3. 假如我们改变的是影响各个层级合并的属性，则只会走Js+Style Recalculate+Composite的过程，会极大的帮我们提升性能，所以我们需要做好图层管理


为了达到流畅的目标，我们可以通过以下的方式去提升FPS
1. Javascript
    1. 在使用动画时，可以通过requestAnimationFrame这个Api来代替setTimeout和setInterval，它的具体使用为根据浏览器的渲染刷新频率，将传入的方法在每一次刷新周期中的最开头先执行一次，以达到稳定、流畅的动画
    2. 如果我们在循环中不断读取offsetWidth等布局属性后，再设置了会再次触发layout过程的属性，会触发强制同步布局（FSL），导致性能下降。
2. CSS
    1. 尽量使用类选择器来选中元素，它是最快解析的选择器，
    2. 如果需要被重复渲染的元素，可以通过transform: translateZ(0)或will-change: transform来使元素被单独渲染，而不影响到其他的元素
