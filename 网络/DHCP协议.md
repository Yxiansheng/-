# DHCP 协议

## 由来

主机想要实现与其它主机进行通信一般有以下两种方式

- 通过设置本机的 IP 地址、子网掩码、网关的 IP 地址、DNS 的 IP 地址实现上网
- 以上方式对于不熟悉计算机的用户不够友好，因为出现了一种动态 IP 地址的上网方式，计算机开机后，会自动被该子网络的**DHCP 服务器**分配一个 IP 地址,它使用的协议为**DHCP 协议**

---

## 概念

DHCP 协议(Dynamic Host Configuration Protocol):动态主机配置协议。它是一种应用层协议，建立在 UDP 协议上

---

## DHCP 服务器

一个子网络中负责管理本网络的所有 IP 地址的一台计算机。
新的计算机加入网络，必须向"DHCP 服务器"发送一个"DHCP 请求"数据包，申请 IP 地址和相关的网络参数。

---

## 数据包

DHCP 数据包由四部分组成：
![DHCP协议数据包图](../文档使用图片/DHCP协议数据包模型.png)

### 以太网标头

设置了本机的 MAC 地址和 DHCP 服务器的 MAC 地址，但此时 DHCP 服务器的 MAC 地址未知，同时本机的 IP 地址未设置,采用广播方式向该子网络上其它所有的计算机发送 DHCP 数据包，所以设置为 FF-FF-FF-FF-FF-FF

### IP 标头

设置本机 IP 地址和 DHCP 服务器的 IP 地址，此时两者都是未知的，所以将发送者 IP 地址设为 0.0.0.0，接受者 IP 地址设为 255.255.255.255

### UDP 标头

设置本机端口和 DHCP 服务器的端口号，DHCP 协议规定发送者端口设置为 67，接受者端口设置为 68

### 数据

子网络中的计算机在接受到来自其它计算机的数据包后，会通过 IP 地址、端口号判断该数据包是否为 DHCP 数据包，若是并且本机是 DHCP 服务器的话，则利用发出者的 MAC 地址返回一个“DHCP 响应数据包”，该数据包的“Data”部分存放着相关的网络参数及一个给发出“DHCP 请求数据包”的计算机的 IP 地 址，若本机不是 DHCP 服务器则弃包
