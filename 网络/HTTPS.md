# HTTPS 协议

## 概念

HTTPS 协议（HyperText Transfer Protocol over Secure Socket Layer）：可以理解为 HTTP+SSL/TLS，即 HTTP 下加入 SSL 层，HTTPS 的安全基础是 SSL，因此加密的详细内容就需要 SSL，用于安全的 HTTP 数据传输

- SSL（Secure Socket Layer，安全套接字层）：1994 年为 Netscape 所研发，SSL 协议位于 TCP/IP 协议与各种应用层协议之间，为数据通讯提供安全支持。

- TLS（Transport Layer Security，传输层安全）：其前身是 SSL，它最初的几个版本（SSL 1.0、SSL 2.0、SSL 3.0）由网景公司开发，1999 年从 3.1 开始被 IETF 标准化并改名，发展至今已经有 TLS 1.0、TLS 1.1、TLS 1.2 三个版本。SSL3.0 和 TLS1.0 由于存在安全漏洞，已经很少被使用到。TLS 1.3 改动会比较大，目前还在草案阶段，目前使用最广泛的是 TLS 1.1、TLS 1.2。

## 对称加密

对称加密又叫做私钥加密，即信息的发送方和接收方使用同一个密钥去加密和解密数据

- 优点：算法公开、加密和解密速度快
- 缺点：客户端一旦被劫持，就可获得密钥，进行数据破解。

## 非对称加密

非对称加密也叫做公钥加密。非对称加密使用一对密钥，即公钥和私钥，且二者成对出现。私钥被自己保存，不能对外泄露。公钥指的是公共的密钥，任何人都
可以获得该密钥。用公钥或私钥中的任何一个进行加密，用另一个进行解密。

- 优点：安全性超强
- 缺点：加密、解密效率不高，加密的数据长度也是有限的。

## 通信流程

- 数字签名：首先 CA 会把持有者的公钥、用途、颁发者、有效时间等信息打成一个包，然后对这些信息进行 Hash 计算，得到一个 Hash 值；然后 CA 会使用自己的私钥将该 Hash 值加密，生成 Certificate Signature，也就是 CA 对证书做了签名；
- 哈希算法：将任意长度的信息转换为较短的固定长度的值，通常其长度要比信息小得多，且算法不可逆

1. 首先客户端向服务端的 443 端口发起 HTTP 请求，服务端同意通信后，返回自己的 SSL 证书。`SSL证书：证书的发布机构CA、有效期、公钥、证书所有者、SSL证书内容数字签名`
2. 浏览器收到证书后，将其中的有效期、公钥等等信息与浏览器下载的所信任的 CA 机构颁发的证书内容进行对比，若对比正确，则使用取出的公钥解密数字签名，获得证书内容的 hash 值，将其证书内容新生成的 hash 值进行对比，对比成功则说明服务器并没有冒充。
3. 浏览器在验证证书合法性后，浏览器会生成一个随机值，该随机值将会在后面真正的数据传输中作为对称加密的密钥，然后客户端会使用证书中的公钥对随机值进行加密生成一个密文，此时客户端将会再次发起携带着该密文的 HTTP 请求给服务端，
4. 服务端拿到上述密文后通过私钥进行解密获取随机值
5. 至此，客户端与服务端即可将随机值作为对称加密的密钥进行通信。
